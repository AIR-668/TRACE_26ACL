Bootstrap: docker
From: pytorch/pytorch:2.2.0-cuda12.1-cudnn8-runtime

%post
    # 基础工具
    apt-get update && apt-get install -y \
        git \
        python3-pip \
        python3-dev \
        build-essential \
        curl \
        vim \
        tmux \
        python-is-python3 \
        && rm -rf /var/lib/apt/lists/*

    # Python 包 - 根据 Aristotle 仓库的 requirements 调整
    pip install --upgrade pip

    # 如果 repo 有 requirements.txt，后面可以在 %files / %post 里拷贝并安装
    # 这里先装通用工具
    pip install \
        backoff==2.2.1 \
        openai==0.27.9 \
        retrying==1.3.4 \
        tqdm==4.67.1 \
        jupyterlab \
        ipykernel \
        wandb

    # 这里预留一个目录，用来 mount 代码
    mkdir -p /workspace

%environment
    export LC_ALL=C
    export LANG=C.UTF-8
    export PYTHONUNBUFFERED=1
    export PYTHONPATH=/workspace:$PYTHONPATH

%runscript
    # 默认行为：进入 /workspace 并启动 bash
    cd /workspace
    exec /bin/bash "$@"
